<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>曲徑</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="曲徑">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="曲徑">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="曲徑">
  
    <link rel="alternative" href="/atom.xml" title="曲徑" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">曲徑</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/howiefh" title="Github" target="_blank"></a>
        
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed" target="_blank"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Immutable-Infrastructure" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2019/01/12/Immutable-Infrastructure/" class="article-date">
  <time datetime="2019-01-12T10:43:25.000Z" itemprop="datePublished">2019-01-12</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/12/Immutable-Infrastructure/">运维的思维升级-不可变基础设施</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
		
		<div id="toc" class="toc-article">
			<h2 class="toc-title"><span>Contents</span></h2>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#运维的思维升级-不可变基础设施"><span class="toc-number">1.</span> <span class="toc-text">运维的思维升级-不可变基础设施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#云原生的定义"><span class="toc-number">1.0.1.</span> <span class="toc-text">云原生的定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是不可变基础设施"><span class="toc-number">1.0.2.</span> <span class="toc-text">什么是不可变基础设施</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可变和不可变基础设施之间的差异"><span class="toc-number">1.0.3.</span> <span class="toc-text">可变和不可变基础设施之间的差异</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不可变基础设施的优势"><span class="toc-number">1.0.4.</span> <span class="toc-text">不可变基础设施的优势</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#提升发布应用效率"><span class="toc-number">1.0.4.1.</span> <span class="toc-text">提升发布应用效率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#没有雪花服务器"><span class="toc-number">1.0.4.2.</span> <span class="toc-text">没有雪花服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#快速水平扩展"><span class="toc-number">1.0.4.3.</span> <span class="toc-text">快速水平扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#简单的回滚和恢复"><span class="toc-number">1.0.4.4.</span> <span class="toc-text">简单的回滚和恢复</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#房多多的不可变基础设施实施细节"><span class="toc-number">1.0.5.</span> <span class="toc-text">房多多的不可变基础设施实施细节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结论"><span class="toc-number">1.1.</span> <span class="toc-text">结论</span></a></li></ol></li></ol>
		
		</div>
		
        <h1 id="运维的思维升级-不可变基础设施"><a href="#运维的思维升级-不可变基础设施" class="headerlink" title="运维的思维升级-不可变基础设施"></a>运维的思维升级-不可变基础设施</h1><p>不可变基础设施（Immutable Infrastructure）是云原生的应用之一，常见的微服务、Service Mesh、容器、声明式API都是可以说是云原生应用。云原生是一个比较抽象的概念，甚至 CNCF 自己也因为其发展速度之快，对定义有过很多次更改。</p>
<h3 id="云原生的定义"><a href="#云原生的定义" class="headerlink" title="云原生的定义"></a>云原生的定义</h3><p>云原生技术有利于各组织在公有云、私有云和混合云等新型动态环境中，构建和运行<strong>可弹性扩展的应用</strong>。云原生的代表技术包括<strong>容器、服务网格、微服务、不可变基础设施</strong>和<strong>声明式API。</strong></p>
<p>这些技术能够构建<strong>容错性好</strong>、<strong>易于管理</strong>和<strong>便于观察</strong>的<strong>松耦合</strong>系统。结合可靠的<strong>自动化</strong>手段，云原生技术使工程师能够轻松地对系统作出<strong>频繁和可预测的重大变更</strong>。</p>
<h3 id="什么是不可变基础设施"><a href="#什么是不可变基础设施" class="headerlink" title="什么是不可变基础设施"></a>什么是不可变基础设施</h3><p>在我们原先（现在还存在）的运维方式里，我们会用物理机或者虚拟机去安装操作系统、逐个上传代码部署业务应用、SSH 连接服务器、手动升级降级软件包的版本。总的来说当基础设施创建以后，它是会被经常更改的，这些物理机或者虚拟机在我的概念里都是 “可变的基础设施”、我从开发的角度认为它是非常传统和手工作坊的感觉。</p>
<p>那相反来说，就可以想象出一个不可变的基础设施应该是怎么样的：在一个基础设施被创建以后，是不接受任何方式的更新的，这个基础设施也可以作为范本不断的扩展成 N 个。如果需要更新修改默写内容，应该先去修改对应的公共的配置，构建新的服务器，然后替换全部旧的服务器。简单的来说就是：旧的不去新的不来 : )</p>
<p>不可变基础设施的优势在于更高的一致性和可靠性，创建、部署的过程也是<strong>可预测</strong>的。还可以避免Configuration Drift（配置漂移，为了解决某个业务特定问题，为某一个服务器安装了一个库等，然后出现了换一个环境应用起不来的情况）、Snowflake Servers（雪花服务器：这个服务器升级了 Python 版本以后，某些应用就是跑不起来）等等。</p>
<h3 id="可变和不可变基础设施之间的差异"><a href="#可变和不可变基础设施之间的差异" class="headerlink" title="可变和不可变基础设施之间的差异"></a>可变和不可变基础设施之间的差异</h3><p>可变基础和不可变基础设施之间最根本的区别在于它们的核心理念：前者旨在在部署后进行更改; 后者旨在保持不变并从根本上进行替换。</p>
<p>Randy Bias提出过一个很有意思的”宠物与牛”概念：传统的可变的基础设施是不可以随便替代的，它们像宠物一样：每一个对你来说都是独一无二的、无法模仿的、自己一手养大的、如果”死了”对你的打击是毁灭性的；可变的基础设施则是相反，它是一次性的、它是很容易通过自动化设施来横向扩展的，它们是一个牛群，没有一个是独一无二或者不可或缺的。</p>
<p>他的原话：</p>
<blockquote>
<p>在旧的做事方式中，我们将服务器视为宠物，例如Bob是一个邮件服务器。如果Bob损坏了，那就全都要靠手动的了。那么首席执行官也就无法收到他的电子邮件了，这无异于是世界末日。但如果以新的方式，服务器会被编号，就像牛群中的牛一样。例如，www001到www100。当一台服务器发生故障时，它会被取回，射击并在线路上更换。</p>
</blockquote>
<p>其实《凤凰项目》这本书里面的 Phoenix 服务器 是一个非常优美的比喻，当我们的基础设施有一天（或者说每时每刻）变成了灰烬，他可以优雅的从头开始构建一个新的服务器。与之对应就是雪花服务器，手工管理，经常更新、形成一个独特的环境。</p>
<h3 id="不可变基础设施的优势"><a href="#不可变基础设施的优势" class="headerlink" title="不可变基础设施的优势"></a>不可变基础设施的优势</h3><h4 id="提升发布应用效率"><a href="#提升发布应用效率" class="headerlink" title="提升发布应用效率"></a><strong>提升发布应用效率</strong></h4><p>基于不可变基础设施的部署都是可以由代码设定的，类似于Dockerfile，这样就可以很简单的用上 git 等版本控制来维护环境。部署应用也不会再依赖服务器之前的状态，在本地能起来，在线上也能起来。很少会出现 “Not Work On My Machine”这样的问题，现在业务开发来私聊我线上应用起不来的问题，我会很有信心的和他说是他的代码问题而不是环境问题。</p>
<h4 id="没有雪花服务器"><a href="#没有雪花服务器" class="headerlink" title="没有雪花服务器"></a>没有雪花服务器</h4><p>我可以允许你登录服务器进行一些 debug，查看日志的操作，但是我知道随便你怎么更改都是无效的，下一次启动就会完全还原，完全不担心。需要更改？请修改配置基础设施的代码。</p>
<h4 id="快速水平扩展"><a href="#快速水平扩展" class="headerlink" title="快速水平扩展"></a>快速水平扩展</h4><p>因为所有服务器都是用同一份配置代码生成，只要有资源，我可以很简单的通过更改副本数就可以完成水平扩展，而非手忙脚乱的开机器、登录、做变更操作。</p>
<h4 id="简单的回滚和恢复"><a href="#简单的回滚和恢复" class="headerlink" title="简单的回滚和恢复"></a>简单的回滚和恢复</h4><p>我可以通过基础设施配置代码的版本控制来快速的回滚到上一个版本，不管你装了多少新的依赖、新的库，对我来说都是一样的。大大缩短了恢复的时间。</p>
<h3 id="房多多的不可变基础设施实施细节"><a href="#房多多的不可变基础设施实施细节" class="headerlink" title="房多多的不可变基础设施实施细节"></a>房多多的不可变基础设施实施细节</h3><p><strong>已完成：</strong></p>
<ol>
<li>业务项目 Docker化</li>
<li>利用 Docker 环境来build Docker Image</li>
<li>CI/CD 流程全部 Pipeline 化，代码化</li>
<li>利用 Portainer,Docker Swarm 搭建面向服务的架构</li>
<li>业务项目尽量无状态化</li>
</ol>
<p><strong>待完成：</strong></p>
<ol>
<li>持久的数据层：集中式的日志保存、有状态服务的存储</li>
<li>底层物理机的不可变基础设施化：Code as Infrastructure</li>
<li>业务开发的运维都理解这层思想，少用 SSH，本地调试而非线上调试</li>
</ol>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>本文是想在运维团队中科普云原生中很重要的基础设施不可变的思想、统一思想。对比了旧式的可变基础设施架构的概念和实际差异、使用它的优势以及实现的详细信息。</p>
<p>相信看完以后大家都会觉得这是一个正确路子，只要方向正确，我们的努力就不会白白浪费！</p>
<p>参考文档：<a href="https://www.digitalocean.com/community/tutorials/what-is-immutable-infrastructure" target="_blank" rel="external">https://www.digitalocean.com/community/tutorials/what-is-immutable-infrastructure</a></p>
<p>推荐听一下在一个基础设施良好的公司的开发体验：<a href="http://codetimecn.com/episodes/devops_tooling" target="_blank" rel="external">http://codetimecn.com/episodes/devops_tooling</a></p>

      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2019/01/12/Immutable-Infrastructure/" data-id="cjqtcidkw000qz7zwzry9jkzz" data_title="运维的思维升级-不可变基础设施" data_summary="运维的思维升级-不可变基础设施不可变基础设施（Immu..." class="article-share-link">Share</a>
      

      
	  
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/devops/">devops</a></li></ul>

	  
<span>
Updated:<time datetime="2019-01-12T10:46:09.405Z" itemprop="dateModified">2019-01-12</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
    <article id="post-monitor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2019/01/08/monitor/" class="article-date">
  <time datetime="2019-01-08T15:08:13.000Z" itemprop="datePublished">2019-01-08</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/08/monitor/">监控系统整理和体系化监控思考</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="监控系统整理和体系化监控思考"><a href="#监控系统整理和体系化监控思考" class="headerlink" title="监控系统整理和体系化监控思考"></a>监控系统整理和体系化监控思考</h1><p>监控是 Devops 中不可或缺的一环，也是运维工作，处理问题排查问题的重要工具，几乎天天会用到。</p>
<p>在房多多现有的监控实践中，我们总是会发现出现一个问题后，会很难去真正排插出问题所在及影响范围，经常需要在各个监控程序之间切换来找到联系；在系统崩溃前，也没有预警来提示风险；在有规律的大流量来临前，没有相关提示要求扩容。</p>
<p>房多多的监控软件基本是完善的，总结整理如下：<br>
        
          <p class="article-more-link">
            <a href="/2019/01/08/monitor/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2019/01/08/monitor/" data-id="cjqtcidla001hz7zwnn5fwatl" data_title="监控系统整理和体系化监控思考" data_summary="监控系统整理和体系化监控思考监控是 Devops 中不..." class="article-share-link">Share</a>
      

      
	  
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/devops/">devops</a></li></ul>

	  
<span>
Updated:<time datetime="2019-01-09T12:59:22.652Z" itemprop="dateModified">2019-01-09</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
    <article id="post-iptables" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2018/09/16/iptables/" class="article-date">
  <time datetime="2018-09-16T10:41:41.000Z" itemprop="datePublished">2018-09-16</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/16/iptables/">iptables</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h1><p>在熟悉 linux 系统之前，只是含糊的指导 iptables 和防火墙相关，这次在学习 docker swarm 等原理时接触到了，故进行总结。</p>
<p>iptables 是运行在User space 的软件（非kernel space），通过空值 Netfilter （位于kernel space）来管理网络数据包的流动和传送，网络地址转换，数据包过滤等防火墙功能。</p>
<h3 id="iptables-的表"><a href="#iptables-的表" class="headerlink" title="iptables 的表"></a>iptables 的表</h3><p>iptables 包换五张表，raw、filter、nat、mangle 和security。</p>
<ol>
<li><code>raw</code> 用于配置数据包， <code>raw</code> 中的数据包不会被系统跟踪。</li>
<li><code>filter</code> 是用于存放所有与防火墙相关操作的默认表。</li>
<li><code>nat</code> 用于 网络地址转换（例如：端口转发）。</li>
<li><code>mangle</code> 用于对特定数据包的修改（参考损坏数据包）。</li>
<li><code>security</code> 用于强制访问控制 网络规则</li>
</ol>
<table>
<thead>
<tr>
<th>规则名称</th>
<th>raw</th>
<th>filter</th>
<th>nat</th>
<th>mangle</th>
<th>security</th>
</tr>
</thead>
<tbody>
<tr>
<td>PREROUTING</td>
<td>是</td>
<td></td>
<td>是</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>INPUT</td>
<td></td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>OUTPUT</td>
<td></td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>POSTROUTING</td>
<td></td>
<td></td>
<td>是</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>FORWARD</td>
<td>是</td>
<td>是</td>
<td></td>
<td>是</td>
<td>是</td>
</tr>
</tbody>
</table>
        
          <p class="article-more-link">
            <a href="/2018/09/16/iptables/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2018/09/16/iptables/" data-id="cjqtcidl9001dz7zwktoe2v6l" data_title="iptables" data_summary="iptables在熟悉 linux 系统之前，只是含糊..." class="article-share-link">Share</a>
      

      
	  
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

	  
<span>
Updated:<time datetime="2018-09-17T16:01:14.794Z" itemprop="dateModified">2018-09-18</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
    <article id="post-old-hawkeye-design" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2018/05/28/old-hawkeye-design/" class="article-date">
  <time datetime="2018-05-28T14:49:17.000Z" itemprop="datePublished">2018-05-28</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/28/old-hawkeye-design/">old-hawkeye-design</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
		
		<div id="toc" class="toc-article">
			<h2 class="toc-title"><span>Contents</span></h2>
		
			
		
		</div>
		
        
      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2018/05/28/old-hawkeye-design/" data-id="cjqtcidlf001sz7zwh89vqjec" data_title="old-hawkeye-design" data_summary="" class="article-share-link">Share</a>
      

      
	  
      
	  
<span>
Updated:<time datetime="2018-05-28T14:49:17.310Z" itemprop="dateModified">2018-05-28</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
    <article id="post-2018" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2018/02/20/2018/" class="article-date">
  <time datetime="2018-02-19T16:15:11.000Z" itemprop="datePublished">2018-02-20</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/20/2018/">2017总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>时间过得真的快啊，又是一年一度的个人思想汇报的时间了。为什么一直选在除夕的晚上呢，因为过年的意义除了和家人团聚，还有就是可以安静下来想想过去一年过的怎么样。<br>
        
          <p class="article-more-link">
            <a href="/2018/02/20/2018/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2018/02/20/2018/" data-id="cjqtcidku000oz7zwydmdyaar" data_title="2017总结" data_summary="时间过得真的快啊，又是一年一度的个人思想汇报的时间了。..." class="article-share-link">Share</a>
      

      
	  
      
	  
<span>
Updated:<time datetime="2018-02-19T16:16:38.903Z" itemprop="dateModified">2018-02-20</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
    <article id="post-django2-0" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2018/01/03/django2-0/" class="article-date">
  <time datetime="2018-01-03T03:54:41.000Z" itemprop="datePublished">2018-01-03</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/03/django2-0/">Django 2.0 升级记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>看到 Django 终于从2.0到了2.0.1，感觉大家坑应该都踩的差不多了，那我们也可以开始升级啦。<br>
        
          <p class="article-more-link">
            <a href="/2018/01/03/django2-0/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2018/01/03/django2-0/" data-id="cjqtcidl40011z7zwufae4oyt" data_title="Django 2.0 升级记" data_summary="看到 Django 终于从2.0到了2.0.1，感觉大..." class="article-share-link">Share</a>
      

      
	  
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li></ul>

	  
<span>
Updated:<time datetime="2018-02-19T16:17:00.737Z" itemprop="dateModified">2018-02-20</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
    <article id="post-git" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2017/10/10/git/" class="article-date">
  <time datetime="2017-10-10T08:16:53.000Z" itemprop="datePublished">2017-10-10</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/10/git/">git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
		
		<div id="toc" class="toc-article">
			<h2 class="toc-title"><span>Contents</span></h2>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Git-笔记"><span class="toc-number">1.</span> <span class="toc-text">Git 笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#删除上一次的-commit"><span class="toc-number">1.0.0.0.1.</span> <span class="toc-text">删除上一次的 commit</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
		
		</div>
		
        <h1 id="Git-笔记"><a href="#Git-笔记" class="headerlink" title="Git 笔记"></a>Git 笔记</h1><h5 id="删除上一次的-commit"><a href="#删除上一次的-commit" class="headerlink" title="删除上一次的 commit"></a>删除上一次的 commit</h5><p>git log 查看上上一次的的 commit id</p>
<p>git reset -soft <commit_id></commit_id></p>

      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2017/10/10/git/" data-id="cjqtcidl8001az7zw72ozfsh4" data_title="git" data_summary="Git 笔记删除上一次的 commitgit log ..." class="article-share-link">Share</a>
      

      
	  
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/">git</a></li></ul>

	  
<span>
Updated:<time datetime="2017-10-10T08:18:08.640Z" itemprop="dateModified">2017-10-10</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
    <article id="post-20170503" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2017/05/03/20170503/" class="article-date">
  <time datetime="2017-05-03T07:51:48.000Z" itemprop="datePublished">2017-05-03</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/03/20170503/">Oracle 分享 记录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>因为以前对 SQL 的细节都不太熟悉，所以先搜索了一些最基础的信息：</p>
<p>什么是 Oracle database: Oracle Database，又名Oracle RDBMS，甲骨文公司开发的关系型数据库。</p>
<h3 id="Oracle-数据库与-Mysql-的架构区别："><a href="#Oracle-数据库与-Mysql-的架构区别：" class="headerlink" title="Oracle 数据库与 Mysql 的架构区别："></a>Oracle 数据库与 Mysql 的架构区别：</h3>
        
          <p class="article-more-link">
            <a href="/2017/05/03/20170503/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2017/05/03/20170503/" data-id="cjqtcidks000mz7zwuliisa2w" data_title="Oracle 分享 记录" data_summary="基础知识因为以前对 SQL 的细节都不太熟悉，所以先搜..." class="article-share-link">Share</a>
      

      
	  
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

	  
<span>
Updated:<time datetime="2017-05-03T07:55:26.000Z" itemprop="dateModified">2017-05-03</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
    <article id="post-20170428" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2017/04/28/20170428/" class="article-date">
  <time datetime="2017-04-28T09:27:20.000Z" itemprop="datePublished">2017-04-28</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/28/20170428/">解决 image not found 问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
		
		<div id="toc" class="toc-article">
			<h2 class="toc-title"><span>Contents</span></h2>
		
			
		
		</div>
		
        <p>原链接：<a href="http://stackoverflow.com/questions/19776571/error-dlopen-library-not-loaded-reason-image-not-found" target="_blank" rel="external">http://stackoverflow.com/questions/19776571/error-dlopen-library-not-loaded-reason-image-not-found</a></p>
<p>在 mac os(os x) 下去引用包的时候会出现很多问题。当直接用 dlopen打开一个绝对路径的 library 时一般是没有问题的。但是如果你加载了一个 library ，同时里面还需要加载另外的包的时候，你就会遇到加载不上的问题。</p>
<p>解决的方法有几个。你可以在你跑程序之前去配对应的环境变量，这就相当于在动态加载时告诉程序去哪儿找需要的lib，但是这不是一个好办法。</p>
<p>每当一个动态库被创建的时候都会有一个 install name，这个名字会包含在二进制文件里面，可以被 otool 命令查看到，otool -L mach-o_binary 会找到虽有包含在里面的动态库。当一个动态库被静态的链接到其他可执行的文件时（二进制文件或者 dylib），它预想的路径可能是一个相对的路径从而会在你的系统上找不到。</p>
<p>另一个解决办法就是install_name_tool，他可以修改预先设定好的路径， It can be run against the dylib before it gets statically linked against (in which case you have nothing left to do), or it can be run against the executable that loads it in order to rewrite those expectations. </p>
<p>例子<code>install_name_tool -change /usr/lib/libphys-services.dylib @rpath/lib/libphys-services.dylib phys_services.so</code>.</p>
<p>相关概念：System Integrity Protection，spawed process</p>

      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2017/04/28/20170428/" data-id="cjqtcidkq000kz7zwrorhoubi" data_title="解决 image not found 问题" data_summary="原链接：http://stackoverflow.co..." class="article-share-link">Share</a>
      

      
	  
      
	  
<span>
Updated:<time datetime="2017-04-28T09:27:55.000Z" itemprop="dateModified">2017-04-28</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
    <article id="post-20170421" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
<a href="/2017/04/20/20170421/" class="article-date">
  <time datetime="2017-04-20T13:25:10.000Z" itemprop="datePublished">2017-04-20</time>
</a>


    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/20/20170421/">20170420周记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
		
		<div id="toc" class="toc-article">
			<h2 class="toc-title"><span>Contents</span></h2>
		
			
		
		</div>
		
        <p>从上一家公司结束以后，好像就丢了写日报/周报这个比较好的习惯。试过几次把培训的内容和学习的内容发到 blog，但是总会有一些拖延症，so 还是写周报/日报吧！<br>这周的工作开始与写一个 sql lab的后端接口，用来接受 sql语句并返回查询结果，需要考虑到的几个点有 支持大多数 数据库，动态切换数据源。<br>用什么来写呢，有三种选择：<br>第一种是 spring boot+data(JPA)，Spring全家桶总是让人感觉很稳健，而且 JDBC对数据库支持的数量也是令人方向的，嗯不错，作为备选方案吧；<br>第二种是 Flask+sqlAlchemy，调研发现 Flask算是比较‘轻’的 Python 框架，算是 Micro Framework，也更加 Pythonic和灵活，也适合像我这种 python初学者。sqlAlchemy也是好评如潮的 Python orm之一 支持的数据库也很齐全，database url 也非常适合用来维护数据源。<br>第三种，django orm，试用了一下就对前面的方法说88了，为什么？因为试用了下就实现了需求啊……Flask 以后见~<br>接下来还遇到几个问题：</p>
<ol>
<li>需要跑多句 sql：sql一般都以分号结尾，那我就直接做一个 split 然后遍历执行 sql语句，按index加到需要返回的 JsonResponse里面就暂时解决了，不知道后面会不会有坑。</li>
<li>原来使用的request.GET[‘param’] 会有问题，换成 request.GET.get(‘param’)才对。</li>
<li>以前没有真正的写过前后端分离的代码，和前端对接的时候就会发现很多问题，比如跨域问题，详细见 blog<a href="http://wangkai1994.github.io/2017/04/15/20170415/" target="_blank" rel="external">http://wangkai1994.github.io/2017/04/15/20170415/</a></li>
<li>切换数据源问题：一开始想的很复杂，想怎么把自己的 数据源Model 的数据加载到 settings里去，查了很久，后来突然想到 settings就是一个 Model啊，修改 database的值不就完了嘛。于是就有了想法，维护一个数据源 Model，里面含 URL。需要切换时，使用的时候用dj_database_url这样一个app来把  database url 解析成一个 Settings里可以正确使用的 dict，赋值给 Settings就 ok。尝试了一下，没有问题。搜索一上午，解决5分钟。</li>
<li>那天解决以后洗澡时突然想到，如果一个人切换了settings里的 database，第二个人也在同时执行查询就会出现问题。所以修改了解决方案，数据源需要随着 sql 查询的请求发过来，每次查询结束以后把定义的数据源清空。这样又出现了另外的一个问题，需要考虑加互斥锁，不然同时操作时一定会出现数据源变化的问题，解决。</li>
</ol>
<p>其他的学习和ideas：</p>
<ol>
<li>只是听过 Restful api，这次真的需要写了就不知如何下手，花了时间补习了<a href="https://cn.udacity.com/course/designing-restful-apis--ud388" target="_blank" rel="external">https://cn.udacity.com/course/designing-restful-apis–ud388</a>，然后快速的过了遍 django-restful-framework 的 Tutorial，意思是 restful接口的增删改差它也能帮你生成一套，简直丧心病狂。</li>
<li>接口需要做身份验证，如果在后台判断登录状态的话那这个接口就是带状态了（突然就理解了为什么要把接口无状态化）。每次传 password和 username反人类也不安全，所以就使用了 token。调研了 token怎么用方便以后，选择了<strong>rest_framework_jwt。</strong>搜索一下午，实现5分钟 again。。。。</li>
<li>搞了搞 spring boot 和 data 的 demo，已经有点感觉不舒服了。</li>
<li>思考了下以往学习的规律，觉得自我学习也不应该太自由，不然容易学了几天就跑去学别的东西，需要有计划性并持之以恒的学习一段时间才会有效果。这次的 Django+python的学习还是持续了一个多月已久，下次的学习一定要给自己定个计划，没有完成加班也要完成。</li>
<li>听了罗振宇的一个思想觉得很有道理：很多毕业生刚进入职场以后往往还是带有一种“考场思维”，觉得上司给任务就是一个考试，如果任务完成如果不夸夸你就很没动力等等症状。但是，职场任务和考试最大的区别是，你可以抄啊！！最近一直面向stackoverflow 编程的我深有体会，人家代码比你实现的优雅为什么不抄呢。还有就是需要会求助他人，可能一个问题你憋了一上午别人一说你就懂了，你成长快速对公司也是好事。工作不是考场，需要把互相协作的优势发挥出来，一起把任务完成的又快又好才是老板想看到的，不会在意你是自己造轮子啊还是怎么实现的。</li>
</ol>

      
    </div>
    <footer class="article-footer">
	  
	  <a data-url="http://yoursite.com/2017/04/20/20170421/" data-id="cjqtcidkn000fz7zwgh2m8d9i" data_title="20170420周记" data_summary="从上一家公司结束以后，好像就丢了写日报/周报这个比较好..." class="article-share-link">Share</a>
      

      
	  
      
	  
<span>
Updated:<time datetime="2017-05-31T13:27:06.000Z" itemprop="dateModified">2017-05-31</time>
</span>


    </footer>
  </div>
  
</article>



<!-- 多说评论框 start -->

<!-- 多说评论框 end -->

  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          
<aside id="sidebar">

  
    
<div class="widget-wrap">
  <h3 class="widget-title">是我啊</h3>
  <ul class="widget about-me">
    
    <li><img class="author" title="About me" src="http://p1.bqimg.com/1949/f866ce3d76cfa776.jpg" /></li>
    
    
    <li>王开/云趣/Java/Python</li>
    
  </ul>
</div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">-数据库</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">-数据结构</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">-算法</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/行业/">-行业</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">-随笔</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/">面试</a><span class="category-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PAT/">PAT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/">devops</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/">leetcode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode-数据结构/">leetcode 数据结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大作业总结/">大作业总结</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/实习/">实习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/总结/">总结</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构-求女友/">数据结构 求女友</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/简历/">简历</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书笔记/">读书笔记</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔/">随笔</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Django/" style="font-size: 13px; color: #7dc3de">Django</a> <a href="/tags/PAT/" style="font-size: 13px; color: #7dc3de">PAT</a> <a href="/tags/devops/" style="font-size: 16.5px; color: #4dbc6f">devops</a> <a href="/tags/git/" style="font-size: 13px; color: #7dc3de">git</a> <a href="/tags/leetcode/" style="font-size: 13px; color: #7dc3de">leetcode</a> <a href="/tags/leetcode-数据结构/" style="font-size: 13px; color: #7dc3de">leetcode 数据结构</a> <a href="/tags/linux/" style="font-size: 13px; color: #7dc3de">linux</a> <a href="/tags/mysql/" style="font-size: 13px; color: #7dc3de">mysql</a> <a href="/tags/大作业总结/" style="font-size: 13px; color: #7dc3de">大作业总结</a> <a href="/tags/实习/" style="font-size: 13px; color: #7dc3de">实习</a> <a href="/tags/总结/" style="font-size: 13px; color: #7dc3de">总结</a> <a href="/tags/数据库/" style="font-size: 16.5px; color: #4dbc6f">数据库</a> <a href="/tags/数据结构/" style="font-size: 20px; color: #1db400">数据结构</a> <a href="/tags/数据结构-求女友/" style="font-size: 13px; color: #7dc3de">数据结构 求女友</a> <a href="/tags/简历/" style="font-size: 13px; color: #7dc3de">简历</a> <a href="/tags/读书笔记/" style="font-size: 13px; color: #7dc3de">读书笔记</a> <a href="/tags/随笔/" style="font-size: 16.5px; color: #4dbc6f">随笔</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/01/12/Immutable-Infrastructure/">运维的思维升级-不可变基础设施</a>
          </li>
        
          <li>
            <a href="/2019/01/08/monitor/">监控系统整理和体系化监控思考</a>
          </li>
        
          <li>
            <a href="/2018/09/16/iptables/">iptables</a>
          </li>
        
          <li>
            <a href="/2018/05/28/old-hawkeye-design/">old-hawkeye-design</a>
          </li>
        
          <li>
            <a href="/2018/02/20/2018/">2017总结</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    

  

</aside>

        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 王开<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/howiefh/hexo-theme-landscape-f" target="_blank" title="Landscape-F">Landscape-F</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<!-- 多说公共JS代码 start (一个网页只需插入一次) -->

<!-- 多说公共JS代码 end -->

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<!--
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.min.js"></script>
-->
<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<div class="bottom-btn">

	<a class="icon-gotop" href="javascript:void(0)" title="返回顶部"></a>
	<script src="/js/gotop.js"></script>
	<!--
	<script src="/js/gotop.js"></script>
	-->


</div>
<script src="/js/toc_aside_toggle.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
